const k=document.getElementById("car-data-input"),T=document.getElementById("user-data-input"),O=document.getElementById("add-user"),x=document.getElementById("clear-user"),_=document.getElementById("add-car"),j=document.getElementById("imageInput"),S=document.getElementById("preview"),w=document.getElementById("modal-imageInput"),P=document.getElementById("modal-preview"),U=document.getElementById("modal-edit-user-button"),J=document.getElementById("modal-close-edit-user-button"),N=document.getElementById("modal-edit-car-button"),D=document.getElementById("modal-close-edit-car-button"),M=document.getElementById("modal-decom-button"),z=document.getElementById("modal-close-decom-button");let E,g,h,L,v;function s(){document.getElementById("user-data-input").innerHTML="",document.getElementById("car-data-input").innerHTML="",fetch("/admin/get_car_list",{method:"POST"}).then(e=>e.json()).then(e=>{for(let t of e){const n=document.createElement("tr");n.id=t[0];const d=document.createElement("td");d.textContent=t[0],n.appendChild(d);const o=document.createElement("td");o.textContent=t[1],n.appendChild(o);const a=document.createElement("td");a.textContent=t[8],n.appendChild(a);const i=document.createElement("td");i.textContent=t[2],n.appendChild(i);const l=document.createElement("td");l.textContent=t[9],n.appendChild(l);const m=document.createElement("td");m.textContent=t[10],n.appendChild(m);const u=document.createElement("td");u.textContent=t[4],n.appendChild(u);const I=document.createElement("td");I.textContent=t[3],n.appendChild(I);const B=document.createElement("td");B.textContent=t[5],n.appendChild(B);const f=document.createElement("td");f.textContent=t[6],n.appendChild(f);const r=document.createElement("td"),p=document.createElement("button");p.classList.add("edit"),p.type="submit",p.textContent="Uprav",p.addEventListener("click",()=>{b("car",t[0],t[1])});const y=document.createElement("button");if(y.classList.add("remove"),y.type="submit",y.textContent="Zmaž",y.addEventListener("click",()=>{C("car",t[0])}),r.appendChild(p),r.appendChild(y),t[3]==="stand_by"){const c=document.createElement("button");c.classList.add("remove"),c.type="submit",c.textContent="Odstavenie",c.addEventListener("click",()=>{H(t[1])}),r.appendChild(c)}else if(t[3]==="service"){const c=document.createElement("button");c.classList.add("remove"),c.type="submit",c.textContent="Aktivácia",c.addEventListener("click",()=>{q(t[1])}),r.appendChild(c)}n.appendChild(r),k.appendChild(n)}}),fetch("/admin/get_user_list",{method:"POST"}).then(e=>e.json()).then(e=>{for(let t of e){const n=document.createElement("tr");n.classList.add(t.id);const d=document.createElement("td");d.textContent=t[0],n.appendChild(d);const o=document.createElement("td");o.textContent=t[1],n.appendChild(o);const a=document.createElement("td");a.textContent=t[2],n.appendChild(a);const i=document.createElement("td");i.textContent=t[3],n.appendChild(i);const l=document.createElement("td"),m=document.createElement("button");m.classList.add("edit"),m.type="submit",m.textContent="Uprav",m.addEventListener("click",()=>{b("user",t[0],t[1]),console.log("Edit clicked")});const u=document.createElement("button");u.classList.add("remove"),u.type="submit",u.textContent="Zmaž",u.addEventListener("click",()=>{C("user",t[2]),console.log("Remove clicked")}),l.appendChild(m),l.appendChild(u),n.appendChild(l),T.appendChild(n)}})}function R(){let e=document.getElementById("user-name").value,t=document.getElementById("user-email").value,n=document.getElementById("user-password").value,d=document.getElementById("user-role").value;fetch("/admin/create_user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:n,role:d})}).then(a=>a.json()).then(a=>{s()})}function A(){let e=document.getElementById("car-name").value,t=document.getElementById("car-type").value,n=document.getElementById("gas-type").value,d=document.getElementById("plate-number").value,o=document.getElementById("location").value,a=document.getElementById("drive-tp").value,i={name:e,type:t,location:o,spz:d,gas:n,drive_tp:a,image:g.result};fetch("/admin/create_car",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(l=>l.json()).then(l=>{s()})}function C(e,t){e==="user"?fetch("/admin/delete_user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:v,email:t})}).then(d=>d.json()).then(d=>{s()}):e==="car"&&fetch("/admin/delete_car",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:v,id:t})}).then(d=>d.json()).then(d=>{s()})}function b(e,t,n){h=t,e==="user"?(document.getElementById("modal-edit-user").style.display="block",document.getElementById("modal-h1-user").innerText=`Uprav používateľa ${n}`):e==="car"&&(document.getElementById("modal-edit-car").style.display="block",document.getElementById("modal-h1-car").innerText=`Uprav auto ${n}`)}function $(){let e={id:h},t=document.getElementById("modal-user-name").value;t!==""&&(e.name=t);let n=document.getElementById("modal-user-email").value;n!==""&&(e.email=n);let d=document.getElementById("modal-user-password").value;d!==""&&(e.password=d);let o=document.getElementById("modal-user-role").value;o!==""&&(e.role=o),e.password.length>7?Object.keys(e).length===1?console.log("Theres nothing to edit"):fetch("/admin/update_user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(a=>a.json()).then(a=>{document.getElementById("modal-edit-user").style.display="none",s()}):console.log("kratke heslo")}function F(){let e={id:h},t=document.getElementById("modal-car-name").value;t!==""&&(e.name=t);let n=document.getElementById("modal-car-type").value;n!==""&&(e.type=n);let d=document.getElementById("modal-drive-tp").value;d!==""&&(e.drive_tp=d);let o=document.getElementById("modal-gas-type").value;o!==""&&(e.gas=o);let a=document.getElementById("modal-plate-number").value;a!==""&&(e.spz=a);let i=document.getElementById("modal-location").value;i!==""&&(e.location=i);let l=E.result;l!==""&&(e.img=l),Object.keys(e).length===1?console.log("Theres nothing to edit"):fetch("/admin/update_car",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(m=>m.json()).then(m=>{document.getElementById("modal-edit-car").style.display="none",s()})}function H(e){L=e,document.getElementById("modal-decom-car").style.display="block",document.getElementById("modal-h1-decom").innerText=`Odstávka auta ${e}`}function Z(){let e=document.getElementById("modal-decom-time").value;e=e.replace("T"," "),fetch("/admin/decommission",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({car_name:L,timeto:e})}).then(n=>n.json()).then(n=>{s()})}function q(e){fetch("/admin/activation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({car_name:e})}).then(n=>n.json()).then(n=>{s()})}U.addEventListener("click",function(){$()});J.addEventListener("click",function(){document.getElementById("modal-edit-user").style.display="none",document.getElementById("modal-user-name").value="",document.getElementById("modal-user-email").value="",document.getElementById("modal-user-password").value="",document.getElementById("modal-user-role").value=""});N.addEventListener("click",function(){F()});D.addEventListener("click",function(){document.getElementById("modal-edit-car").style.display="none",document.getElementById("modal-car-name").value="",document.getElementById("modal-car-type").value="",document.getElementById("modal-drive-tp").value="",document.getElementById("modal-gas-type").value="",document.getElementById("modal-plate-number").value="",document.getElementById("modal-location").value="",document.getElementById("modal-imageInput").value="",document.getElementById("modal-preview").src=""});M.addEventListener("click",function(){Z()});z.addEventListener("click",function(){document.getElementById("modal-decom-car").style.display="none",document.getElementById("modal-decom-time").value=""});O.addEventListener("click",function(){R()});_.addEventListener("click",function(){A()});x.addEventListener("click",()=>{document.getElementById("user-name").value="",document.getElementById("user-email").value="",document.getElementById("user-password").value="",document.getElementById("modal-car-name").value="",document.getElementById("car-type").value="",document.getElementById("drive-tp").value="",document.getElementById("gas-type").value="",document.getElementById("plate-number").value="",document.getElementById("location").value="",document.getElementById("imageInput").value="",document.getElementById("preview").src=""});j.addEventListener("change",function(){const e=this.files[0];e&&(g=new FileReader,g.onload=function(t){S.src=t.target.result},g.readAsDataURL(e))});w.addEventListener("change",function(){const e=this.files[0];e&&(E=new FileReader,E.onload=function(t){P.src=t.target.result},E.readAsDataURL(e))});document.addEventListener("DOMContentLoaded",function(){s(),fetch("/get_session_data",{method:"POST"}).then(e=>e.json()).then(e=>{v=e.role,e.username})});
