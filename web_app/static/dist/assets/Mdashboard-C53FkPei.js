const C=document.getElementById("welcome-message"),i=document.getElementById("modal-monthly"),T=document.getElementById("modal-backdrop");let f=null;function M(){fetch("/get_session_data",{method:"POST"}).then(n=>n.json()).then(n=>{f=n.username,C.innerText=`Vitaj ${f}!`})}function b(n){i.innerHTML="";const a=new Intl.DateTimeFormat("sk-SK",{weekday:"long",year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});let t=n.start.toISOString().replace("T"," "),e=n.end.toISOString().replace("T"," ");t=new Date(t),e=new Date(e),t=a.format(t),e=a.format(e),t=String(t).charAt(0).toUpperCase()+String(t).slice(1),e=String(e).charAt(0).toUpperCase()+String(e).slice(1);const o=document.createElement("div");o.classList.add("modal-monthly-content");const d=document.createElement("h2");d.innerHTML=n.title,o.appendChild(d);const u=document.createElement("h3");u.innerHTML=n.extendedProps.driver_email,o.appendChild(u);const l=document.createElement("label");l.innerHTML="Od:",l.setAttribute("for","start"),o.appendChild(l);const h=document.createElement("p");h.innerHTML=t,o.appendChild(h);const r=document.createElement("label");r.innerHTML="Do:",r.setAttribute("for","end"),o.appendChild(r);const p=document.createElement("p");p.innerHTML=e,o.appendChild(p);const s=document.createElement("label");s.innerHTML="Status:",s.setAttribute("for","status"),o.appendChild(s);const g=document.createElement("p");g.innerHTML=n.extendedProps.status===!0?"Aktívne":"Ukončené",o.appendChild(g);const c=document.createElement("label");c.innerHTML="Poznámka:",c.setAttribute("for","note"),o.appendChild(c);const y=document.createElement("p");y.innerHTML=n.extendedProps.note!==""?n.extendedProps.note:"žiadna",o.appendChild(y);const m=document.createElement("button");m.innerHTML="Odísť",m.onclick=function(){w()},o.appendChild(m),i.appendChild(o),T.style.display="block",i.style.display="block"}function E(n){const a=document.getElementById("calendar"),t=new FullCalendar.Calendar(a,{height:750,initialView:"timeGridMonth",locale:"sk",selectable:!0,allDayText:"Celý deň",nowIndicator:!0,headerToolbar:{right:"timeGridMonth,timeGridWeek,timeGridDay"},events:n.map(e=>({title:e[3],start:e[0],end:e[1],extendedProps:{driver_email:e[4],status:e[2],note:e[5]},color:e[6]})),views:{timeGridMonth:{type:"timeGrid",visibleRange:function(e){const o=new Date(e.getFullYear(),e.getMonth(),1),d=new Date(e.getFullYear(),e.getMonth()+1,1);return{start:o,end:d}},buttonText:"Mesiac",classNames:["time-grid-month"],dateIncrement:{months:1},dayHeaderFormat:{day:"numeric",month:"numeric"}},timeGridWeek:{buttonText:"Týždeň"},timeGridDay:{buttonText:"Deň"},timeGridToday:{buttonText:"Dnes"}},customButtons:{this:{buttonText:"Dnes",click:function(){t.today()}}},eventClick:function(e){b(e.event)}});document.getElementsByClassName("fc-timegrid-axis-cushion fc-scrollgrid-shrink-cushion fc-scrollgrid-sync-inner").innerText="Celý deň",document.getElementById("loading-message").style.display="none",t.render()}function L(n){fetch("/manager/get_monthly_leases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({month:n})}).then(a=>a.json()).then(a=>{for(let t of a)t.push(k()),t[0]=new Date(t[0]),t[1]=new Date(t[1]);E(a)})}function k(){const n="0123456789ABCDEF";let a="#";for(let t=0;t<6;t++)a+=n[Math.floor(Math.random()*16)];return a}function w(){i.style.display="none",T.style.display="none"}document.addEventListener("DOMContentLoaded",function(){M();const n=new Date().getMonth()+1;L(n)});
